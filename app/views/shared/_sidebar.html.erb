<% current_is_edit_user = current_page?(edit_user_registration_path) %>
<% current_is_search = current_page?(search_path) %>
<% current_is_new_run = current_page?(new_run_path) %>
<% current_is_teams = current_page?(teams_path) %>
<% current_is_profile = current_page?(profile_path) %>

<div class="hidden h-full flex-[0.3] min-w-72 max-w-[350px] md:block">
  <nav
    data-controller="modal"
    data-modal-hide-modal-class="opacity-0 scale-75 pointer-events-none"
    data-modal-show-modal-class="opacity-100 scale-100 pointer-events-auto"
    data-modal-hide-backdrop-class="opacity-0 pointer-events-none"
    data-modal-show-backdrop-class="opacity-100 pointer-events-auto"
    class="h-[calc(100%-2.5rem)] flex flex-col overflow-y-auto p-4 bg-slate-50 dark:bg-slate-800 border dark:border-slate-700 m-5 mr-0 rounded-lg shadow-lg"
  >
    <div class="mb-4 text-xl font-bold">
      <span class="text-indigo-500">Team</span><span>Runner</span>
    </div>

    <!-- Main navigation links -->
    <div class="mb-6 space-y-1.5">
      <%= link_to profile_path, aria: { current: current_is_profile ? 'page' : nil }, class: "group sidebar-link #{'sidebar-link-active' if current_is_profile}" do %>
        <% if current_user.avatar.attached? %>
          <%= image_tag current_user.avatar.variant(resize_to_limit: [50, 50]).processed, class: 'size-6 rounded-md drop-shadow-lg dark:drop-shadow-none object-cover motion-safe:group-hover:bounce-animation motion-safe:group-focus:bounce-animation' %>
        <% elsif current_is_profile %>
          <%= inline_svg_tag 'icons/profile-filled.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:bounce-animation motion-safe:group-focus:bounce-animation' %>
        <% else %>
          <%= inline_svg_tag 'icons/profile.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:bounce-animation motion-safe:group-focus:bounce-animation' %>
        <% end %>
        <span>Profile</span>
      <% end %>
      <%= link_to teams_path, aria: { current: current_is_teams ? 'page' : nil }, class: "group sidebar-link #{'sidebar-link-active' if current_is_teams}" do %>
        <% if current_is_teams %>
          <%= inline_svg_tag 'icons/team-filled.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:gelatine-animation motion-safe:group-focus:gelatine-animation' %>
        <% else %>
          <%= inline_svg_tag 'icons/team.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:gelatine-animation motion-safe:group-focus:gelatine-animation' %>
        <% end %>
        <span>Teams</span>
      <% end %>
      <%= link_to search_path, aria: { current: current_is_search ? 'page' : nil }, class: "group sidebar-link #{'sidebar-link-active' if current_is_search}" do %>
        <% if current_is_search %>
          <%= inline_svg_tag 'icons/search-filled.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:wiggle-animation motion-safe:group-focus:wiggle-animation' %>
        <% else %>
          <%= inline_svg_tag 'icons/search.svg', class: 'size-5 text-soft dark:group-focus:text-white motion-safe:group-hover:wiggle-animation motion-safe:group-focus:wiggle-animation' %>
        <% end %>
        <span>Search</span>
      <% end %>
      <%= link_to edit_user_registration_path, aria: { current: current_is_edit_user ? 'page' : nil }, class: "group sidebar-link #{'sidebar-link-active' if current_is_edit_user}" do %>
        <% if current_is_edit_user %>
          <%= inline_svg_tag 'icons/settings-filled.svg', class: 'size-5 text-soft dark:group-focus:text-white spin-animation motion-safe:group-hover:spin motion-safe:group-focus:spin' %>
        <% else %>
          <%= inline_svg_tag 'icons/settings.svg', class: 'size-5 text-soft dark:group-focus:text-white spin-animation motion-safe:group-hover:spin motion-safe:group-focus:spin' %>
        <% end %>
        <span>Settings</span>
      <% end %>
    </div>

    <div class="mb-6">
      <!-- Pinned pages -->
      <%= render 'pinned_pages/list' %>
      <!-- Pin/Unpin page button -->
      <%= render 'pinned_pages/pin_button', page_url: request.fullpath %>
    </div>

    <!-- Open New Run Modal Button -->
    <button data-action="click->modal#open" data-modal-id="newRunModal" class="btn btn-lg btn-primary mt-auto gap-3">
      <%= inline_svg_tag 'icons/runner.svg', class: 'size-5' %>
      <span>New run</span>
    </button>

    <!-- New Run Modal Backdrop -->
    <div
      data-modal-target="backdrop"
      data-modal-id="newRunModal"
      data-action="click->modal#backdropClose"
      class="modal-backdrop opacity-0 pointer-events-none"></div>

    <!-- New Run Modal -->
    <div
      id="newRunModal"
      role="dialog"
      tabindex="-1"
      data-modal-target="modal"
      class="modal opacity-0 pointer-events-none"
    >
      <div class="flex flex-col space-y-1.5 text-center sm:text-left mb-6">
        <h2 class="text-lg font-semibold leading-none tracking-tight">New Run</h2>
      </div>

      <%= render 'runs/form_modal', run: Run.new %>

      <!-- Close button -->
      <button data-action="click->modal#close" type="button" data-modal-id="newRunModal" class="absolute right-0 top-0 p-4 rounded-lg opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-offset-2">
        <%= inline_svg_tag 'icons/x-mark.svg', class: 'size-4' %>
        <span class="sr-only">Close</span>
      </button>
    </div>
  </nav>
</div>
